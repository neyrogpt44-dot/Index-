<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>SGSHOP138 | Professional Store</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --main: #ff0000; --bg: #000; --border: #1a1a1a; --gray: #888; }
        * { box-sizing: border-box; }
        body { background: var(--bg); color: #fff; font-family: 'Inter', sans-serif; margin: 0; padding-top: 80px; }

        /* HEADER - –ö–æ–ø–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã Firebox */
        header { position: fixed; top: 0; width: 100%; height: 80px; background: rgba(0,0,0,0.9); backdrop-filter: blur(10px); z-index: 1000; border-bottom: 1px solid var(--border); }
        .header_main { max-width: 1440px; margin: 0 auto; display: flex; align-items: center; justify-content: space-between; padding: 0 40px; height: 100%; }
        .logo img { height: 32px; }
        .header-nav { display: flex; gap: 25px; }
        .nav-link { font-size: 13px; font-weight: 700; text-transform: uppercase; color: var(--gray); text-decoration: none; transition: 0.3s; }
        .nav-link:hover, .nav-link.active { color: #fff; }

        /* FILTER BAR */
        .filter-wrapper { background: #000; border-bottom: 1px solid var(--border); position: sticky; top: 80px; z-index: 900; }
        .filter-content { max-width: 1440px; margin: 0 auto; padding: 15px 40px; display: flex; justify-content: space-between; align-items: center; }
        
        .grid-control { display: flex; align-items: center; gap: 15px; }
        .grid-control span { font-size: 11px; font-weight: 900; color: #444; }
        input[type="range"] { accent-color: var(--main); width: 100px; cursor: pointer; }

        /* MAIN LAYOUT */
        .main-container { max-width: 1440px; margin: 0 auto; display: flex; padding: 0 40px; }
        
        /* SIDEBAR */
        aside { width: 260px; padding: 40px 0; flex-shrink: 0; border-right: 1px solid var(--border); }
        .filter-group-title { font-size: 12px; font-weight: 900; text-transform: uppercase; color: #444; margin-bottom: 20px; display: block; }
        .brand-item { color: var(--gray); font-size: 14px; margin-bottom: 12px; cursor: pointer; transition: 0.2s; display: block; }
        .brand-item:hover, .brand-item.active { color: #fff; font-weight: 700; }

        /* PRODUCTS GRID */
        .catalog-area { flex-grow: 1; padding: 40px 0 40px 40px; }
        .products-grid { display: grid; gap: 20px; }
        
        /* –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Ä–∞–∑–º–µ—Ä—ã —Å–µ—Ç–∫–∏ */
        .grid-cols-4 { grid-template-columns: repeat(4, 1fr); }
        .grid-cols-3 { grid-template-columns: repeat(3, 1fr); }
        .grid-cols-2 { grid-template-columns: repeat(2, 1fr); }

        /* PRODUCT CARD */
        .card { background: #080808; border: 1px solid var(--border); transition: 0.4s cubic-bezier(0.165, 0.84, 0.44, 1); }
        .card:hover { border-color: #333; transform: translateY(-5px); }
        .card-img { aspect-ratio: 1/1.1; display: flex; align-items: center; justify-content: center; padding: 30px; overflow: hidden; }
        .card-img img { max-width: 100%; transition: 0.6s; }
        .card:hover .card-img img { transform: scale(1.1); }
        
        .card-info { padding: 20px; border-top: 1px solid var(--border); background: #000; }
        .card-brand { font-size: 10px; color: var(--main); font-weight: 900; text-transform: uppercase; margin-bottom: 5px; }
        .card-name { font-size: 14px; color: #eee; height: 40px; overflow: hidden; line-height: 1.4; margin-bottom: 15px; }
        .card-footer { display: flex; justify-content: space-between; align-items: center; }
        .price { font-size: 18px; font-weight: 900; }
        .buy-btn { width: 35px; height: 35px; background: #fff; border: none; font-weight: 900; cursor: pointer; transition: 0.3s; }
        .buy-btn:hover { background: var(--main); color: #fff; }

        /* CART PANEL */
        .cart-panel { position: fixed; right: -100%; top: 0; width: 450px; height: 100%; background: #000; z-index: 2000; border-left: 1px solid var(--border); transition: 0.5s; padding: 40px; }
        .cart-panel.active { right: 0; }
        
        @media (max-width: 1024px) {
            aside { display: none; }
            .catalog-area { padding: 20px 0; }
            .grid-cols-4, .grid-cols-3 { grid-template-columns: repeat(2, 1fr); }
            .cart-panel { width: 100%; }
        }
    </style>
</head>
<body>

<header>
    <div class="header_main">
        <div class="logo"><img src="santa.png" alt="SGSHOP138"></div>
        <nav class="header-nav">
            <a href="#" class="nav-link active">–ö–∞—Ç–∞–ª–æ–≥</a>
            <a href="#" class="nav-link">–ù–æ–≤–∏–Ω–∫–∏</a>
            <a href="#" class="nav-link">–ë—Ä–µ–Ω–¥—ã</a>
        </nav>
        <div class="header-actions" onclick="toggleCart(true)" style="cursor:pointer">
            üõí <span id="cart-count" style="background:var(--main); padding:2px 7px; border-radius:10px; font-size:10px;">0</span>
        </div>
    </div>
</header>

<div class="filter-wrapper">
    <div class="filter-content">
        <div class="filter-left">
            <span id="current-filter-name" style="font-weight:900; text-transform:uppercase; font-size:12px;">–í—Å–µ —Ç–æ–≤–∞—Ä—ã</span>
        </div>
        <div class="grid-control">
            <span>–°–ï–¢–ö–ê</span>
            <input type="range" min="2" max="4" step="1" value="4" oninput="changeGrid(this.value)">
        </div>
    </div>
</div>

<div class="main-container">
    <aside>
        <span class="filter-group-title">–ë—Ä–µ–Ω–¥—ã</span>
        <div id="brands-menu">
            <a class="brand-item active" onclick="filterBrand('all')">–í—Å–µ –±—Ä–µ–Ω–¥—ã</a>
            </div>
    </aside>

    <main class="catalog-area">
        <div class="products-grid grid-cols-4" id="catalog">
            </div>
    </main>
</div>

<div class="cart-panel" id="cart">
    <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid var(--border); padding-bottom:20px;">
        <h2 style="font-weight:900; margin:0;">–ö–û–†–ó–ò–ù–ê</h2>
        <span onclick="toggleCart(false)" style="cursor:pointer; font-size:24px;">‚úï</span>
    </div>
    <div id="cart-items" style="margin-top:20px; flex-grow:1; overflow-y:auto;"></div>
    <div style="font-size:24px; font-weight:900; padding:20px 0;">–ò–¢–û–ì–û: <span id="total-price">0</span> ‚ÇΩ</div>
    <button onclick="sendOrder()" style="width:100%; background:var(--main); color:#fff; border:none; padding:20px; font-weight:900; cursor:pointer;">–û–§–û–†–ú–ò–¢–¨ –ß–ï–†–ï–ó TG</button>
</div>

<script>
    let allProducts = [];
    let cart = [];

    async function loadStock() {
        try {
            const res = await fetch('/api/get'); // –°—Å—ã–ª–∫–∞ –Ω–∞ —Ç–≤–æ–π XML
            const xml = new DOMParser().parseFromString(await res.text(), "text/xml");
            
            allProducts = Array.from(xml.querySelectorAll("offer")).map(el => {
                const name = el.querySelector("name")?.textContent || "";
                return {
                    id: el.getAttribute('id'),
                    name: name,
                    brand: name.split(' ')[0], // –ü–µ—Ä–≤–æ–µ —Å–ª–æ–≤–æ –∏–∑ –Ω–∞–∑–≤–∞–Ω–∏—è –∫–∞–∫ –±—Ä–µ–Ω–¥
                    price: parseInt(el.querySelector("price")?.textContent || 0),
                    img: el.querySelector("picture")?.textContent || ""
                };
            });

            buildBrandMenu();
            render(allProducts);
        } catch (e) { console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö"); }
    }

    function buildBrandMenu() {
        const brands = [...new Set(allProducts.map(p => p.brand))].sort();
        const menu = document.getElementById('brands-menu');
        brands.forEach(b => {
            const link = document.createElement('a');
            link.className = 'brand-item';
            link.innerText = b;
            link.onclick = () => filterBrand(b, link);
            menu.appendChild(link);
        });
    }

    function render(data) {
        const grid = document.getElementById('catalog');
        grid.innerHTML = data.map(p => `
            <div class="card">
                <div class="card-img"><img src="${p.img}" loading="lazy"></div>
                <div class="card-info">
                    <div class="card-brand">${p.brand}</div>
                    <div class="card-name">${p.name}</div>
                    <div class="card-footer">
                        <div class="price">${p.price.toLocaleString()} ‚ÇΩ</div>
                        <button class="buy-btn" onclick="addToCart('${p.id}')">+</button>
                    </div>
                </div>
            </div>
        `).join('');
    }

    function changeGrid(val) {
        const grid = document.getElementById('catalog');
        grid.className = `products-grid grid-cols-${val}`;
    }

    function filterBrand(brand, el) {
        document.querySelectorAll('.brand-item').forEach(i => i.classList.remove('active'));
        if(el) el.classList.add('active');
        document.getElementById('current-filter-name').innerText = brand === 'all' ? '–í—Å–µ —Ç–æ–≤–∞—Ä—ã' : brand;
        
        const filtered = brand === 'all' ? allProducts : allProducts.filter(p => p.brand === brand);
        render(filtered);
    }

    function addToCart(id) {
        const p = allProducts.find(x => x.id === id);
        cart.push(p);
        updateCartUI();
        toggleCart(true);
    }

    function updateCartUI() {
        document.getElementById('cart-count').innerText = cart.length;
        let total = 0;
        document.getElementById('cart-items').innerHTML = cart.map((p, i) => {
            total += p.price;
            return `<div style="display:flex; gap:15px; margin-bottom:20px; align-items:center;">
                <img src="${p.img}" style="width:60px; height:60px; object-fit:contain; background:#111;">
                <div style="flex-grow:1;">
                    <div style="font-size:11px; color:#888;">${p.name}</div>
                    <div style="font-weight:900;">${p.price.toLocaleString()} ‚ÇΩ</div>
                </div>
                <span onclick="removeFromCart(${i})" style="cursor:pointer; color:var(--main)">‚úï</span>
            </div>`;
        }).join('');
        document.getElementById('total-price').innerText = total.toLocaleString();
    }

    function removeFromCart(index) {
        cart.splice(index, 1);
        updateCartUI();
    }

    function toggleCart(state) {
        document.getElementById('cart').classList.toggle('active', state);
    }

    function sendOrder() {
        if(!cart.length) return;
        let text = "–ù–û–í–´–ô –ó–ê–ö–ê–ó SGSHOP138:\n\n";
        cart.forEach(p => text += `‚Ä¢ ${p.name} ‚Äî ${p.price}‚ÇΩ\n`);
        text += `\n–ò–¢–û–ì–û: ${document.getElementById('total-price').innerText} ‚ÇΩ`;
        window.open(`https://t.me/–¢–í–û–ô_–ù–ò–ö?text=${encodeURIComponent(text)}`);
    }

    loadStock();
</script>
</body>
</html>
